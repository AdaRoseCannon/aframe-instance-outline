!function(t,n){"use strict";const e=new n.Matrix4,i=new n.Matrix4,r=[];class a extends n.SkinnedMesh{constructor(t,e,i){super(t,e),this.instanceMatrix=new n.InstancedBufferAttribute(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1,this._mesh=null}copy(t){return super.copy(t),t.isInstancedMesh&&(this.instanceMatrix.copy(t.instanceMatrix),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count),this}getColorAt(t,n){n.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,n){n.fromArray(this.instanceMatrix.array,16*t)}raycast(t,a){const o=this.matrixWorld,s=this.count;null===this._mesh&&(this._mesh=new n.SkinnedMesh(this.geometry,this.material),this._mesh.copy(this));const c=this._mesh;if(void 0!==c.material)for(let n=0;n<s;n++){this.getMatrixAt(n,e),i.multiplyMatrices(o,e),c.matrixWorld=i,c.raycast(t,r);for(let t=0,e=r.length;t<e;t++){const e=r[t];e.instanceId=n,e.object=this,a.push(e)}r.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new n.InstancedBufferAttribute(new Float32Array(3*this.instanceMatrix.count),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,n){n.toArray(this.instanceMatrix.array,16*t)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}function o(t){t.vertexShader=t.vertexShader.replace("void main() {","\n\tflat varying int instanceID;\n\t#ifdef USE_ENVMAP\n\t\t#ifndef ENV_WORLDPOS\n\t\t\tvarying vec3 vWorldPosition;\n\t\t#endif\n\t#else\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\tvoid main() {\n\t"),t.vertexShader=t.vertexShader.replace("#include <project_vertex>","\n\tvec4 mvPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tmvPosition = instanceMatrix * mvPosition;\n\t#endif\n\tmvPosition = modelViewMatrix * mvPosition;\n\tmvPosition += vec4(vNormal * 0.015 * (1.0 - float(gl_InstanceID)), .0);\n\tgl_Position = projectionMatrix * mvPosition;\n    instanceID = gl_InstanceID;\n\t"),t.fragmentShader=t.fragmentShader.replace("void main() {","\n\tflat varying int instanceID;\n\tuniform mat4 modelViewMatrix;\n\t#ifdef USE_ENVMAP\n\t\t#ifndef ENV_WORLDPOS\n\t\t\tvarying vec3 vWorldPosition;\n\t\t#endif\n\t#else\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifndef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n\t#endif\n\tvoid main() {\n\t"),t.fragmentShader=t.fragmentShader.replace("}","\n\tvec4 posInView = modelViewMatrix * vec4(vWorldPosition, 1.0);\n\tposInView /= posInView[3];\n\tvec3 VinView = normalize(-posInView.xyz);\n\tgl_FragColor.rgb = vec3(1.,1.,1.);\n\tgl_FragColor.a = float(instanceID);\n}")}a.prototype.isInstancedMesh=!0;const s=(new THREE.Matrix4).makeScale(1,1,1);function c(t){const n=[];t.traverse((t=>{if(t instanceof THREE.Mesh&&!(t instanceof THREE.InstancedMesh||t instanceof a)){const e=t instanceof THREE.SkinnedMesh?new a(t.geometry,t.material,2):new THREE.InstancedMesh(t.geometry,t.material,2);t.material.onBeforeCompile=o,t.material.transparent=!0,t.material.side=THREE.DoubleSide,t.updateMatrixWorld(),e.setMatrixAt(0,s),e.setMatrixAt(1,s);const i=t.parent.children,r=i.indexOf(t);e.children=t.children,e.parent=t.parent,n.push((()=>i[r]=e))}}));for(const t of n)t()}AFRAME.registerComponent("outline",{schema:{},init(){this.onLoad=()=>c(this.el.object3D),this.el.addEventListener("object3dset",this.onLoad),this.onLoad()}}),t.makeOutline=c,Object.defineProperty(t,"__esModule",{value:!0})}({},THREE);
//# sourceMappingURL=aframe-instance-outline.min.js.map
